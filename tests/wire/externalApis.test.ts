// This file was auto-generated by Fern from our API Definition.

import * as AuiApi from "../../src/api/index";
import { AuiApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("ExternalApis", () => {
    test("getTasksByUserId (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AuiApiClient({
            apiKey: "test",
            networkApiKey: "test",
            environment: { base: server.baseUrl, staging: server.baseUrl },
        });

        const rawResponseBody = {
            tasks: [
                {
                    id: "id",
                    user_id: "user_id",
                    title: "title",
                    welcome_message: "welcome_message",
                    followup_suggestions: ["followup_suggestions"],
                },
            ],
            total: 1,
            page: 1,
            size: 1,
        };
        server
            .mockEndpoint()
            .get("/api/v1/external/tasks")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.externalApis.getTasksByUserId({
            user_id: "user_id",
            page: 1,
            size: 1,
        });
        expect(response).toEqual({
            tasks: [
                {
                    id: "id",
                    user_id: "user_id",
                    title: "title",
                    welcome_message: "welcome_message",
                    followup_suggestions: ["followup_suggestions"],
                },
            ],
            total: 1,
            page: 1,
            size: 1,
        });
    });

    test("getTasksByUserId (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AuiApiClient({
            apiKey: "test",
            networkApiKey: "test",
            environment: { base: server.baseUrl, staging: server.baseUrl },
        });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/api/v1/external/tasks")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.externalApis.getTasksByUserId({
                user_id: "user_id",
            });
        }).rejects.toThrow(AuiApi.UnprocessableEntityError);
    });

    test("task (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AuiApiClient({
            apiKey: "test",
            networkApiKey: "test",
            environment: { base: server.baseUrl, staging: server.baseUrl },
        });
        const rawRequestBody = { user_id: "user_id" };
        const rawResponseBody = {
            id: "id",
            user_id: "user_id",
            title: "title",
            welcome_message: "welcome_message",
            followup_suggestions: ["followup_suggestions"],
        };
        server
            .mockEndpoint()
            .post("/api/v1/external/tasks")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.externalApis.task({
            user_id: "user_id",
        });
        expect(response).toEqual({
            id: "id",
            user_id: "user_id",
            title: "title",
            welcome_message: "welcome_message",
            followup_suggestions: ["followup_suggestions"],
        });
    });

    test("task (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AuiApiClient({
            apiKey: "test",
            networkApiKey: "test",
            environment: { base: server.baseUrl, staging: server.baseUrl },
        });
        const rawRequestBody = { user_id: "user_id" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/api/v1/external/tasks")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.externalApis.task({
                user_id: "user_id",
            });
        }).rejects.toThrow(AuiApi.UnprocessableEntityError);
    });

    test("getTaskMessages (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AuiApiClient({
            apiKey: "test",
            networkApiKey: "test",
            environment: { base: server.baseUrl, staging: server.baseUrl },
        });

        const rawResponseBody = [
            {
                id: "id",
                created_at: "created_at",
                text: "text",
                sender: { id: "id", type: "user", email: "email" },
                receiver: { id: "id", type: "user", email: "email" },
                options: [{ is_recommended: true, widget_parameters: [{ title: "title", type: "boolean" }] }],
                variants_options: [{ is_recommended: true, widget_parameters: [{ title: "title", type: "boolean" }] }],
                followup_suggestions: ["followup_suggestions"],
            },
        ];
        server
            .mockEndpoint()
            .get("/api/v1/external/tasks/task_id/messages")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.externalApis.getTaskMessages("task_id");
        expect(response).toEqual([
            {
                id: "id",
                created_at: "created_at",
                text: "text",
                sender: {
                    id: "id",
                    type: "user",
                    email: "email",
                },
                receiver: {
                    id: "id",
                    type: "user",
                    email: "email",
                },
                options: [
                    {
                        is_recommended: true,
                        widget_parameters: [
                            {
                                title: "title",
                                type: "boolean",
                            },
                        ],
                    },
                ],
                variants_options: [
                    {
                        is_recommended: true,
                        widget_parameters: [
                            {
                                title: "title",
                                type: "boolean",
                            },
                        ],
                    },
                ],
                followup_suggestions: ["followup_suggestions"],
            },
        ]);
    });

    test("getTaskMessages (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AuiApiClient({
            apiKey: "test",
            networkApiKey: "test",
            environment: { base: server.baseUrl, staging: server.baseUrl },
        });

        const rawResponseBody = {};
        server
            .mockEndpoint()
            .get("/api/v1/external/tasks/task_id/messages")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.externalApis.getTaskMessages("task_id");
        }).rejects.toThrow(AuiApi.UnprocessableEntityError);
    });

    test("message (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AuiApiClient({
            apiKey: "test",
            networkApiKey: "test",
            environment: { base: server.baseUrl, staging: server.baseUrl },
        });
        const rawRequestBody = { task_id: "task_id", text: "text" };
        const rawResponseBody = {
            id: "id",
            created_at: "created_at",
            text: "text",
            sender: { id: "id", type: "user", email: "email" },
            receiver: { id: "id", type: "user", email: "email" },
            options: [{ is_recommended: true, widget_parameters: [{ title: "title", type: "boolean" }] }],
            variants_options: [{ is_recommended: true, widget_parameters: [{ title: "title", type: "boolean" }] }],
            followup_suggestions: ["followup_suggestions"],
        };
        server
            .mockEndpoint()
            .post("/api/v1/external/message")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.externalApis.message({
            is_external_api: true,
            task_id: "task_id",
            text: "text",
        });
        expect(response).toEqual({
            id: "id",
            created_at: "created_at",
            text: "text",
            sender: {
                id: "id",
                type: "user",
                email: "email",
            },
            receiver: {
                id: "id",
                type: "user",
                email: "email",
            },
            options: [
                {
                    is_recommended: true,
                    widget_parameters: [
                        {
                            title: "title",
                            type: "boolean",
                        },
                    ],
                },
            ],
            variants_options: [
                {
                    is_recommended: true,
                    widget_parameters: [
                        {
                            title: "title",
                            type: "boolean",
                        },
                    ],
                },
            ],
            followup_suggestions: ["followup_suggestions"],
        });
    });

    test("message (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AuiApiClient({
            apiKey: "test",
            networkApiKey: "test",
            environment: { base: server.baseUrl, staging: server.baseUrl },
        });
        const rawRequestBody = { task_id: "task_id", text: "text" };
        const rawResponseBody = {};
        server
            .mockEndpoint()
            .post("/api/v1/external/message")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.externalApis.message({
                task_id: "task_id",
                text: "text",
            });
        }).rejects.toThrow(AuiApi.UnprocessableEntityError);
    });
});
